# 如何查看训练输出

## 📊 环境分配说明

训练使用**20个并行环境**，每个环境对应一个地图类型：

| 环境ID | 地图类型 | 说明 |
|--------|----------|------|
| 0-3 | empty-16-16-random | 4个环境，每个环境随机选择该地图的任务 |
| 4-7 | room-64-64-8_random | 4个环境，每个环境随机选择该地图的任务 |
| 8-11 | den520d_random | 4个环境，每个环境随机选择该地图的任务 |
| 12-15 | warehouse-10-20-random | 4个环境，每个环境随机选择该地图的任务 |
| 16-19 | roadmap-sparse | 4个环境，每个环境随机选择该地图的任务 |

**重要**：
- 每个环境在创建时会随机选择一个任务文件
- 每次reset()时会重新随机选择任务（实现跨任务训练）
- 环境16属于roadmap-sparse地图

## 🔍 查看训练输出的方法

### 方法1: 查看tmux会话（推荐，实时输出）

```bash
# 连接到tmux会话
tmux attach -t training

# 在tmux中，你会看到：
# - 训练进度条
# - 实时日志输出
# - 冲突选择信息
# - 奖励信息

# 退出tmux（不停止训练）：按 Ctrl+b，然后按 d
```

### 方法2: 查看日志文件（最详细）

```bash
# 实时查看日志（推荐）
tail -f /root/zhongjie_test_1/continuous_CBS/logs/train_stdout.log

# 查看最后100行
tail -n 100 /root/zhongjie_test_1/continuous_CBS/logs/train_stdout.log

# 搜索特定信息
grep -E "Episode|收敛|检查点" /root/zhongjie_test_1/continuous_CBS/logs/train_stdout.log
```

### 方法3: 使用TensorBoard（可视化）

```bash
# 在tmux新pane中启动TensorBoard
# 按 Ctrl+b，然后按 " 创建新pane
tensorboard --logdir ./logs/tensorboard --host 127.0.0.1 --port 6006

# 然后在本地建立SSH端口转发
ssh -L 6006:127.0.0.1:6006 root@your-server-ip

# 浏览器打开
http://127.0.0.1:6006
```

## 📝 日志中的关键信息

### 训练进度
```
   0%                               20/6,000,000  [ 0:00:30 < -:--:-- , ? it/s ]
```
- 20/6,000,000：当前步数/总步数
- 0:00:30：已用时间

### Episode统计（每10个episode打印一次）
```
Episode 10/80000: 最近平均奖励=-2.3456, 最佳奖励=5.1234, 收敛状态=训练中
```

### 环境执行信息
```
current step: 3
current cardinal: [0]          # 主要冲突数
current semi_cardinal: [4]     # 半主要冲突数
current non_cardinal: [40]     # 非主要冲突数
current reward: 0.345          # 当前奖励
is done: False                 # 是否完成
```

### 收敛检测
```
[收敛检测] Episode 500: 检测到收敛! 最近100个episode的平均奖励=6.1234, 标准差=0.0123
```

### 检查点保存
```
[检查点] 保存检查点到: ppo_ccbs_multi_map_checkpoint_step200000 (步数: 200000)
```

## ⚠️ 关于环境16失败

环境16属于roadmap-sparse地图。如果它创建失败：

1. **不影响训练**：其他19个环境已经足够训练
2. **可能原因**：
   - 随机选择的任务文件格式有问题（但我们已经修复了代码）
   - 子进程创建时的临时问题
   - 某些任务文件确实有问题

3. **解决方案**：
   - 代码已经增加了重试机制（最多20次）
   - 如果所有重试都失败，SubprocVecEnv会继续使用其他环境
   - 训练可以正常进行

## 🎯 快速查看命令

```bash
# 1. 查看训练是否在运行
ps aux | grep train_ppo_parallel

# 2. 查看最新日志
tail -f /root/zhongjie_test_1/continuous_CBS/logs/train_stdout.log

# 3. 查看Episode统计
grep "Episode" /root/zhongjie_test_1/continuous_CBS/logs/train_stdout.log | tail -5

# 4. 查看是否有错误
grep -i "error\|失败\|exception" /root/zhongjie_test_1/continuous_CBS/logs/train_stdout.log | tail -10

# 5. 连接到tmux查看实时输出
tmux attach -t training
```


